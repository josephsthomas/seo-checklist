{
  "package_number": 4,
  "batches": [
    4
  ],
  "total_defects": 30,
  "fixed_count": 29,
  "skipped_count": 1,
  "unique_files": [
    "src/components/readability/ReadabilityIssuesTable.jsx",
    "src/hooks/useNotifications.js",
    "src/hooks/useProjects.js",
    "src/hooks/useSchemaLibrary.js"
  ],
  "defects": [
    {
      "batch": 4,
      "bug_id": "R01-201",
      "severity": "MEDIUM",
      "category": "Missing Error Handling",
      "file_path": "src/hooks/useNotifications.js",
      "line": "60",
      "description": "markAllAsRead uses a Firestore writeBatch without checking if the number of unread notifications exceeds the Firestore batch limit of 500 operations. If a user has more than 500 unread notifications, ",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R03-204",
      "severity": "LOW",
      "category": "Tone Inconsistency",
      "file_path": "src/hooks/useNotifications.js",
      "line": "73",
      "description": "Error toast 'Failed to mark all as read' uses a technical/terse phrasing inconsistent with other user-facing messages",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R04-208",
      "severity": "MEDIUM",
      "category": "IA Problem",
      "file_path": "src/hooks/useNotifications.js",
      "line": "86",
      "description": "The createNotification function (useNotifications.js:86) accepts a 'type' parameter with no validation or import from the canonical NOTIFICATION_TYPES defined in src/utils/roles.js:122. The notificati",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R05-202",
      "severity": "MEDIUM",
      "category": "Screen Reader",
      "file_path": "src/hooks/useNotifications.js",
      "line": "41",
      "description": "Notification count updates are not announced via ARIA live region. When new notifications arrive through Firestore realtime listener, the unreadCount state changes but there is no aria-live region mec",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R08-C-008",
      "severity": "HIGH",
      "category": "Workflow Gap",
      "file_path": "src/hooks/useNotifications.js",
      "line": "77",
      "description": "The useNotifications hook only provides markAsRead and markAllAsRead operations but has no capability to delete notifications. Over time, users will accumulate an unbounded number of notification docu",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R09-C-005",
      "severity": "HIGH",
      "category": "Error Logging",
      "file_path": "src/hooks/useNotifications.js",
      "line": "98",
      "description": "The createNotification function (lines 86-101) silently swallows all errors in its catch block with an empty body and a comment 'Silently fail - notification creation is non-critical'. Similarly, mark",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R10-C-003",
      "severity": "MEDIUM",
      "category": "Missing Error State",
      "file_path": "src/hooks/useNotifications.js",
      "line": "36",
      "description": "The onSnapshot listener for notifications does not include an error callback handler. If the query fails, the loading state remains true and the user never sees their notifications. Additionally, the ",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R10-C-004",
      "severity": "HIGH",
      "category": "Feedback Gap",
      "file_path": "src/hooks/useNotifications.js",
      "line": "60",
      "description": "The markAllAsRead function uses Firestore writeBatch without any size limit check. Firestore batches are limited to 500 operations. If a user has more than 500 unread notifications, the batch.commit()",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R01-202",
      "severity": "HIGH",
      "category": "Missing Error Handling",
      "file_path": "src/hooks/useProjects.js",
      "line": "90",
      "description": "getProject is an async function that calls getDoc without a try/catch. If the Firestore call fails (network error, permission denied), the unhandled promise rejection will crash the caller without any",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R08-C-001",
      "severity": "CRITICAL",
      "category": "Permission Issue",
      "file_path": "src/hooks/useProjects.js",
      "line": "80",
      "description": "The deleteProject function performs no authorization check before deleting a project document from Firestore. Any authenticated user who obtains a projectId can call deleteProject and permanently remo",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R08-C-002",
      "severity": "CRITICAL",
      "category": "Data Integrity",
      "file_path": "src/hooks/useProjects.js",
      "line": "80",
      "description": "When a project is deleted, there is no cascade cleanup of related data. The system stores comments (useComments), file attachments (useFileAttachments), time entries (useTimeTracking), project links (",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R08-C-010",
      "severity": "MEDIUM",
      "category": "Lifecycle Issue",
      "file_path": "src/hooks/useProjects.js",
      "line": "49",
      "description": "The project lifecycle has no status management. The createProject function stores whatever is in projectData without enforcing an initial status. There is no defined project status workflow (e.g., dra",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R08-C-011",
      "severity": "MEDIUM",
      "category": "Audit Trail",
      "file_path": "src/hooks/useProjects.js",
      "line": "66",
      "description": "Project create, update, and delete operations generate no audit log entries. There is an 'activity_log' collection referenced in useUserProfile.js (line 148), but no project CRUD operation writes to i",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R09-C-016",
      "severity": "LOW",
      "category": "Error Logging",
      "file_path": "src/hooks/useProjects.js",
      "line": "90",
      "description": "The getProject function (lines 90-97) has no try-catch error handling. If the Firestore getDoc call fails due to a network error, permission issue, or invalid projectId, the error will bubble up as an",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R10-C-001",
      "severity": "HIGH",
      "category": "Missing Error State",
      "file_path": "src/hooks/useProjects.js",
      "line": "37",
      "description": "The onSnapshot listener in useProjects does not include an error callback. If the Firestore query fails (e.g., due to missing index, permissions error, or network disconnection), the loading state rem",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R10-C-002",
      "severity": "HIGH",
      "category": "Undo Missing",
      "file_path": "src/hooks/useProjects.js",
      "line": "80",
      "description": "The deleteProject function permanently deletes a project from Firestore without any confirmation dialog or undo mechanism. A simple toast.success is shown after deletion, but there is no way to recove",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R01-106",
      "severity": "MEDIUM",
      "category": "Performance Bug",
      "file_path": "src/components/readability/ReadabilityIssuesTable.jsx",
      "line": "159",
      "description": "The SortHeader component is defined as a function inside the render body of ReadabilityIssuesTable. This means it is recreated on every render, causing React to unmount and remount all SortHeader inst",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R03-107",
      "severity": "MEDIUM",
      "category": "Terminology Inconsistency",
      "file_path": "src/components/readability/ReadabilityIssuesTable.jsx",
      "line": "37",
      "description": "Category label 'Technical Access.' is an awkward truncation of 'Technical Accessibility'. This abbreviation with a trailing period is inconsistent with other category labels which are fully spelled ou",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R03-108",
      "severity": "LOW",
      "category": "Terminology Inconsistency",
      "file_path": "src/components/readability/ReadabilityIssuesTable.jsx",
      "line": "39",
      "description": "Category label 'AI Signals' in the Issues table differs from the 'AI-Specific Signals' label used in the Category Accordion (ReadabilityCategoryAccordion.jsx:49). Users see different names for the sam",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R04-108",
      "severity": "MEDIUM",
      "category": "Taxonomy Issue",
      "file_path": "src/components/readability/ReadabilityIssuesTable.jsx",
      "line": "37",
      "description": "The CATEGORY_LABELS map in ReadabilityIssuesTable abbreviates 'Technical Accessibility' to 'Technical Access.' (with a trailing period), while the same category is labeled 'Technical Accessibility' in",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R04-109",
      "severity": "LOW",
      "category": "Labeling Issue",
      "file_path": "src/components/readability/ReadabilityIssuesTable.jsx",
      "line": "39",
      "description": "The CATEGORY_LABELS map in ReadabilityIssuesTable uses 'AI Signals' as the label for the aiSignals category, while ReadabilityCategoryAccordion uses 'AI-Specific Signals'. The shorter label omits the ",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R05-109",
      "severity": "HIGH",
      "category": "Keyboard Nav Gap",
      "file_path": "src/components/readability/ReadabilityIssuesTable.jsx",
      "line": "309",
      "description": "Table rows with expandable details use onClick on <tr> elements but are not keyboard accessible. The <tr> elements have no tabIndex, role, or onKeyDown handler, so keyboard users cannot expand row det",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R05-110",
      "severity": "HIGH",
      "category": "Keyboard Nav Gap",
      "file_path": "src/components/readability/ReadabilityIssuesTable.jsx",
      "line": "162",
      "description": "The SortHeader component renders sortable <th> elements with onClick handlers but no keyboard support (same pattern as ReadabilityCoverageTable). The <th> elements are not focusable and have no onKeyD",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R01-212",
      "severity": "MEDIUM",
      "category": "Missing Error Handling",
      "file_path": "src/hooks/useSchemaLibrary.js",
      "line": "122",
      "description": "incrementUsage calls updateDoc without a try/catch and references the stale `schemas` array from closure state. If the schema was deleted between renders, the find at line 123 may succeed with stale d",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R03-210",
      "severity": "LOW",
      "category": "Tone Inconsistency",
      "file_path": "src/hooks/useSchemaLibrary.js",
      "line": "62",
      "description": "Auth error message 'Please log in to save schemas' uses 'log in' while useReportBuilder uses 'sign in' for the same scenario",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R08-C-012",
      "severity": "MEDIUM",
      "category": "Scope Gap",
      "file_path": "src/hooks/useSchemaLibrary.js",
      "line": "108",
      "description": "The deleteSchema function does not verify ownership before deletion. Any authenticated user who knows a schema ID can delete another user's schema from the library. Additionally, schemas can be marked",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R10-C-010",
      "severity": "MEDIUM",
      "category": "Undo Missing",
      "file_path": "src/hooks/useSchemaLibrary.js",
      "line": "108",
      "description": "The deleteSchema function permanently deletes a schema from the library without any confirmation or undo mechanism. Schemas that users have carefully built, tagged, and used multiple times can be acci",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R10-C-016",
      "severity": "MEDIUM",
      "category": "Missing Error State",
      "file_path": "src/hooks/useSchemaLibrary.js",
      "line": "50",
      "description": "The onSnapshot error handler for useSchemaLibrary (line 50-53) catches errors and sets loading to false, but does not expose the error to the consuming component. Unlike useReportBuilder which sets an",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R10-C-017",
      "severity": "LOW",
      "category": "Edge Case",
      "file_path": "src/hooks/useSchemaLibrary.js",
      "line": "122",
      "description": "The incrementUsage function performs a non-atomic read-then-write update on the usageCount field. It reads the current count from the local schemas state (line 123) and then writes the incremented val",
      "status": "fixed",
      "skip_reason": "",
      "fix_approach": ""
    },
    {
      "batch": 4,
      "bug_id": "R11-C-013",
      "severity": "MEDIUM",
      "category": "Governance Gap",
      "file_path": "src/hooks/useSchemaLibrary.js",
      "line": "75",
      "description": "The schema library allows users to mark schemas as public (isPublic: true, line 75) but there is no governance mechanism to review or approve publicly shared schemas. Any user can make a schema public",
      "status": "skipped",
      "skip_reason": "Schema library lets any user publish \u2014 no governance",
      "fix_approach": "Add approval workflow; gate with canPublishSchemas permission"
    }
  ]
}